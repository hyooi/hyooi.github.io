---
layout: post
title:  "마이크로서비스"
---

# Microservices
- 하나의 어플리케이션을 다수의 독립적인 서비스들의 집합으로 구성하는 것
- 서비스는 각자의 **별도의 프로세스**에서 실행되며, http api와 같은 가벼운 매커니즘으로 통신
- 서비스들은 각자의 비즈니스 기능을 담당
- 서로 다른 프로그래밍 언어나 database를 사용할 수 있음
- **독립**적으로 배포
- amazone, netflix가 대표적인 마이크로서비스 기반 회사


## Monolithic의 이슈 해결
- 작은 서비스 단위로 확장 가능
- 일부의 장애가 전체 시스템 장애로 이어지지 않음
- 서비스 단위 배포 가능
- **빠르게 변화하는 비즈니스 환경에 민첩한 대응**이 가능


## MSA가 인기를 끄는 이유
- 비즈니스 환경이 빠르게 급변하므로 그에 대응할 수 있어야함
- Cloud computing이 발전해 msa의 탄력적인 운용이 가능해짐
- 전통적인 RDBMS를 넘어 no sql이 안정화되면서, db선택 가능 범위가 넓어짐
- docker, kubernates등의 컨테이너 시스템이 안정화되며,
대용량 마이크로 서비스가 운영될 수 있는 토대 마련됨
- netflix oss가 msa를 위한 안정적인 라이브러리 제공


## 장점
- 각각의 서비스는 독립적으로 개발되어 빠르게 빌드, 테스트, 배포됨
- 작은 서비스 단위로 확장 가능(트래픽이 몰리는 서비스만 선택적 확장)
- Polyglot architecture지원
  - 각 서비스에 맞는 고유한 언어, framework사용 가능
- 서비스 크기가 작아 품질 관리에 용이. 코드 개선시 영향도가 낮음


## 단점
- 서버 리소스 사용이 monolith보다 비효율적
- 내부 호출보다 성능이 떨어짐
- 서비스 마다 jvm 등 중복 사용
- 모니터링 대상 증가 및 다양한 장애 상황 발생 등의 운영 어려움
- 배포 대상 서비스 증가 및 기술의 다변화
- 트랜잭션 처리 어려움
- 서비스 간 polyglot data store사용


## MSA의 특징
1. 서비스를 통한 컴포넌트화
- 서비스 간에는 명확한 인터페이스로 협력
- 하나의 서비스는 특정 비즈니스 기능을 담당하며, 독립적인 프로세스로 실행하고 독립적으로 배포됨

2. 비즈니스 역량에 따른 조직 구성
- 조직의 구조가 시스템의 아키텍처에 영향을 줌
- 전통적 조직은 단일 비즈니스 기능을 변경해도 다수 팀 간의 협업을 필요로 했음
- MSA조직은 기술 역량에 따른 팀 구성이 아닌, 비즈니스 역량에 따른 조직을 따름
  - EX. 상품전시팀: 기획자, FE개발자, BE개발자, 디자이너, 테스터...
  - 아마존에서는 피자2판을 한 끼로 먹을 수 있는 정도의 규모를 팀으로 구성해야 한다고 말함
- 서비스를 만들 수 있는 역량을 팀 내부에서 모두 갖추고 있음

3. 프로젝트보다 제품에 집중
- 전통적 모델은 개발/운영 조직이 분리되어 있음
- MSA에서는 팀이 개발,운영을 포함한 전체 라이프사이클을 책임짐

4. 똑똑한 end point, 단순한 pipe
- 도메인 로직은 서비스 내에 응집도 높게 유지
- 각 서비스 간의 연결은 기존의 ESB와 같은 central bus가 아닌, 
rest api나 message queue 등을 이용해 decentralize하게 운용함

5. 분산된 거버넌스
- 각 서비스에 가장 적합한 기술 적용
- 표준이나 절차 준수를 강요하지 않음

6. 분산된 데이터 관리
- 서비스의 데이터를 각자 관리
- 각 서비스는 api를 통해서만 다른 서비스의 데이터에 접근
- 데이터의 일관성이 바로 맞춰지는 것이 아닌, 시간이 지나야 적용되는 단점

7. 인프라 자동화
- 다수의 서비스와 인스턴스가 존재하므로 자동화 필수
- 자동화 테스팅, ci, cd

8. 장애 방지 설계
- 일부 서비스의 장애가 전체로 이어지는 것을 막아야 함
- 서비스의 이상 동작을 신속하게 알 수 있어야 함
- netflix는 장애를 유발해 테스트하기도 함
- 일부의 장애가 전체로 이어지지 않도록 하는 circuit breaker패턴 적용


## MSA도입 조건
- MSA가 비즈니스 benefit을 올릴 수 있다는 합의
- 조직 변화가 필요하므로 단순 기술 도입이 아닌, 조직과 프로세스의 개선 작업 필요
- devops 문화 정착되어야 함
- 전통적인 on premise환경에서는 많은 서비스를 빠른 배포해야하는 msa를 도입하기 어려움,
따라서 클라우드 환경이 필수적이며, docker/kubernates등의 컨테이너 오케스트레이션 기술이 필요함 
- 다양한 레벨의 실시간 모니터링


## 적용하기
- 모놀리틱을 한번에 MSA로 변경하지 않는다.
- 비즈니스 변화에 민첩하게 대응해야 하고, 요구사항 변경이 빈번한 기능부터 분리
- 중요도가 낮고 작은 모듈부터 분리해야 함
