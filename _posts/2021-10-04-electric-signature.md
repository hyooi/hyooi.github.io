---
layout: post
title:  "HTTPS? 디지털 인증서?"
categories:
- 보안
tags:
- 인증서
---

### 1. 개요
인터넷 서핑을 하다보면 브라우저에 보이는 자물쇠가 있다.
아래와 같은 버튼인데, 클릭해보면 **보안연결이 사용되었다**는 문구가 나타난다.

![http-lock](/assets/images/http-lock.PNG)

사용자에게는 해당 자물쇠의 유무가 인터넷 서핑에 그닥 영향을 미치지 않지만,
실제 네트워크 상에는 <ins>정보를 안전하게 주고받을 수 있는 장치가 추가되어 있는 것</ins>이다.

오늘은 해당 인증이 어떻게 진행되는지 정리할 예정이다.

<br/>

### 2. HTTPS
먼저 위에서 말하는 **보안연결(HTTPS)**란, 인터넷에서 정보를 교환할 때 사용하는 프로토콜인 HTTP에 
암호화 프로토콜(SSL, TLS)을 추가한 것이다.
> OSI 7Layer중 http는 응용계층에 해당되는데, SSL, TLS는 그 하위 레이어인 표현 계층에 해당한다.

SSL은 과거의 보안 기술로 최근에는 모두 TLS프로토콜을 사용한다고 생각하면 되는데,
이 때 필요한 것이 위의 캡쳐에서 확인했던 **인증서**이다.

<br/>

### 3. 디지털 인증서
아무 도메인이나 접속해서 자물쇠 버튼을 클릭하고, 인증서를 클릭해보자.

그러면 다음과 같은 팝업이 뜰 것이다.

![certificate](/assets/images/blog-certificate.png)

어디서 발급해주었고, 해당 인증서의 유효기간은 어떻게되며 어느 도메인을 통해 발급받았는지,
심지어는 <ins>서명 알고리즘에 인증서 내용까지</ins> 확인할 수 있다.

뭔가 중요한 정보들을 모조리 확인할 수 있는 것 같은데, 이걸 통해 어떻게 신뢰할 수 있는걸까?

인증서는 비대칭키 암호화 방식을 사용하는데, 해당 암호화 방식을 이해하면 그 과정을 이해할 수 있다.

<br/>

#### 3.1. 비대칭키 암호화방식(=공개키 암호화 방식)
비대칭키 암호화 방식은 기본적으로 **공개키와 개인키, 2개의 키를 생성**한다.
여기서 공개키는 방금 전 확인한 것처럼 누구나 사용할 수 있도록 공개하며, 비밀키는 안전하게 보관한다.
> 때문에 공개키 암호화 방식이라고도 불린다.

데이터를 요청했을 때, <ins>서버는 데이터를 개인키로 암호화해서 전송</ins>하고, 
사용자가 사용하는 <ins>브라우저는 가지고 있던 공개키(인증서)로 복호화해 데이터가 신뢰가능한지 판단</ins>한다.

위의 캡처에서 서명 알고리즘이 **SHA256RSA**라고 나와있는데,
여기서 SHA256은 해시 알고리즘이며 RSA는 비대칭키 암호화방식 중 한가지이다.

비대칭키 암호화 방식에는 RSA뿐만 아니라 DSA, 비트코인에서 사용하는 ECSDA가 있다.

<br/>

#### 3.2. HTTPS 통신 시 암호화 과정
##### 3.2.1. 웹서버에 비밀키 등록
그럼 실제로 인터넷을 통해 <var>https://hyooi.github.io/</var>에 접근했을 때, 가져온 데이터를 어떻게 신뢰할 수 있는지 정리해보자.

먼저, github는 **비대칭키 암호화 방식에 따른 두 쌍의 키를 발급**받는다.

그리고 하나는 사용자에게 공개하고, 비밀키는 <var>https://hyooi.github.io/</var>를 호스팅하고 있는 github의 웹서버에 등록했을 것이다.

그렇게되면 해당 웹서버를 통해 받아오는 데이터는 모두 

<br/>

##### 3.2.2. 데이터 송신
통신 시에는 원본을 해시값을 통해 해싱한 결과를 암호화하여 서명을 만드는데,
해당 서명을 원본에 달아 보낸다. 즉, 전송 시엔 원본 바이너리 + 서명이 된다.

<br/>

##### 3.2.3. 데이터 수신
그리고 브라우저에서 전송된 데이터를 확인할 시에는,
반대로 먼저 원본 바이너리와 서명을 분리한다.
그리고 공개키를 통해 해싱한 값(a)을 얻고, 원본을 해싱해 조금 전에 해싱한 값(a)과 동일한지 확인한다.
이 때 값이 동일하면 바이너리가 변조되지 않았음을 확인할 수 잇따.

<br/>

##### 3.2.4. 인증서(공개키) 신뢰 가능 여부
![root-ca](/assets/images/root-ca.png)

이 때, 바이너리를 복호화한 공개키는 어떻게 신뢰할 수 있을까?
그건 인증서를 발급해주는 기관(CA)에 있다.
OS나 브라우저는 기본적으로 Root CA를 가지고 있는데, 내가 발급받은 인증서의 기관의 상위CA, 
즉 Root CA가 신뢰 가능하다면 접속을 허가하는 것이다.

그러므로 직접 서명한 인증서(self-signed certificate)는 암만 웹서버에 등록해봤자
root ca를 확인할 수 없으므로 접속이 차단된다.

또한, root ca가 만료되는 케이스도 있는데(gitlab-ssl-2참조) 이 경우에도 접속이 불가하다.
os는 기본적으로 root ca의 인증서를 주기적으로 업데이트해서 가지고 있으므로 일반적으론 없는 상황이긴 하다.

<br/>

#### 4. 결론
