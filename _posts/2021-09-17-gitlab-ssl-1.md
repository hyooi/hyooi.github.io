---
layout: post
title:  "서버 인증서 적용기1. Aws route53 서브도메인 발급"
categories:
- git
- aws
tags:
- route53
---

### 1. 개요
gitlab을 http로 사용 중이었는데, 보안을 위해 ssl을 적용하기로 결정했다.

인증서만 별도로 구입해 적용할 수도 있겠지만, 편의를 위해 <ins>도메인을 구입하고,
해당 도메인에 LetsEncrypt에서 인증서를 발급받아 적용</ins>하기로 했다.

이를 위해 먼저 **Aws route53**에서 도메인을 발급받은 과정을 정리한다.

<br/>

### 2. 도메인 발급
#### 2.1. 도메인 등록
![route53-1](/assets/images/git/route53-1.png)
Aws route53 화면에 접속하게 되면, 위와 같은 대시보드가 등장한다.
난 이미 도메인을 등록한 상태이므로 1로 나오는데, 아무 등록을 하지 않았다면 0으로 보여질 것이다.

먼저, 구입하고 싶은 도메인을 입력하고 확인을 클릭한다.

<br/>

#### 2.2. 도메인 구입
![route53-2](/assets/images/git/route53-2.png)
구입 가능한 도메인을 자동 제안해준다.

도메인에 따라 가격이 조금씩 다른데, 아무래도 인기도가 낮을 수록 가격이 저렴해지는 것 같다.
이 중 원하는 도메인을 클릭해 구입한다.

<br/>

### 3. 도메인 설정
![route53-3](/assets/images/git/route53-3.png)

도메인을 구입하고 나면, 2.1.의 대시보드에 구입한 도메인이 등장한다.

호스팅 설정을 위해 **Route53 > 호스팅영역**에서 구입한 도메인을 클릭한다.
처음에는 위 캡쳐에서 상위 2개의 레코드만 확인되는데,
<ins>레코드 생성</ins>버튼을 클릭해 호스팅하고자 하는 도메인과 서버IP를 입력한다.

값에는 <ins>포트를 제외한 서버IP를 입력</ins>하면 되고, <ins>레코드이름에는 구입한 도메인</ins>이 기본 설정된다.

EX. 레코드이름(도메인): kello.com, 값(호스팅할 서버IP): 21.11.11.11

<br/>

### 3.1. 서브 도메인 설정
그런데 호스팅할 서비스가 여러개라면 어떻게 해야할까?

아티팩토리에도 도메인을 붙이고 싶고, gitlab에도 도메인을 붙이고싶다.
이럴 때는 매번 도메인을 구입해야 할까?

이런 경우에는 **서브도메인**을 설정하면 하나의 도메인으로도 여러 서비스를 호스팅할 수 있다.
<var>artifactory.kello.com</var>로 접속할 때는 <var>아티팩토리</var>로, 
<var>gitlab.kello.com</var>로 접속할 때는 <var>gitlab</var>으로 접근하게 설정하는 것이다.

이를 위해 위처럼 각각의 서브 도메인을 레코드로 추가해준다.
각각의 서브도메인은 nginx로 프록시할 예정인데, 이를 위해 값을 모두 
nginx가 기동되는 서버인 21.11.11.11로 등록한다.

<br/>

### 3. 결론
이렇게 도메인 구입 및 레코드 등록을 완료했다.

route53은 굉장히 빠르게 등록되는 것을 확인할 수 있는데,
상위와 같이 등록했다고 했을 때, artifactory.kello.com으로 접속하면 <ins>바로 21.11.11.11의 80포트에서 기동 중인 서비스를 
호출</ins>하게 된다.

그러나 지금은 별도의 프록시 설정을 하지 않았으므로, artifactory.kello.com과 gitlab.kello.com **모두 같은 서비스를 호출**한다.
다음 챕터에서는 각각의 서브도메인에 맞는 서비스를 호출하도록 nginx를 설정한 내용을 정리할 예정이다.
